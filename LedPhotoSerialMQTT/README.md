# Управление освещением с обменом данными по MQTT

Этот проект демонстрирует создание распределённой IoT-системы для автоматического управления освещением. Система состоит из микроконтроллера-датчика и микроконтроллера-исполнителя, которые взаимодействуют с ПК по UART, а ПК обмениваются данными между собой через MQTT.

## Архитектура

Система построена на взаимодействии четырех ключевых компонентов через MQTT-брокер:

```
[Sensor MCU] <--UART--> [PC1: Python + MQTT Publisher]
                                                            |
                                                            v
                                                        [MQTT Broker]----> [Monitor]
                                                            |
                                                            v
[Actuator MCU] <--UART--> [PC2: Python + MQTT Subscriber]
```

-   **Sensor MCU**: Считывает данные с фоторезистора и передаёт их на ПК по UART.
-   **PC1 (Publisher)**: Получает данные от Sensor MCU и публикует их в MQTT-топик `iot/project/sensor/data`.
-   **PC2 (Subscriber)**: Подписывается на топик с данными, анализирует их и отправляет команды управления на Actuator MCU.
-   **Actuator MCU**: Получает команды по UART и управляет светодиодом (вкл/выкл).
-   **Monitor**: Подписывается на все топики проекта (`iot/project/#`) для отладки и мониторинга.

## Логика работы и результат

Основная логика системы заключается в автоматической реакции на изменение уровня освещенности.

1.  Скрипт `sensor_publisher.py` запрашивает у Sensor MCU непрерывный поток данных об освещённости и публикует каждое полученное значение в MQTT.
2.  Скрипт `actuator_subscriber.py` получает эти данные. Если значение освещённости падает ниже заданного порога (`LUMINOSITY_THRESHOLD = 35`), он отправляет по UART команду на включение светодиода (`u`). Если освещённость выше порога — команду на выключение (`d`).
3.  Микроконтроллеры обмениваются с ПК по простому текстовому протоколу.

**Результат**: система автономно поддерживает заданный уровень освещенности. Когда темнеет, свет включается; когда светлеет — выключается. Весь процесс обмена данными прозрачен и может отслеживаться в реальном времени с помощью скрипта-монитора.

## Как запустить

1.  **Аппаратная часть**: Сборка схемы [Tinkercad](https://www.tinkercad.com/things/3uNTQRh8Hnh-dazzling-bojo-amberis?sharecode=PM9C8GZkO4KR_8xvapQ_dClvWD8puZUtMyC6fyu72xc).
2.  **Прошивка**: Загрузите скетчи из папки `arduino_code` на соответствующие микроконтроллеры с помощью Arduino IDE.
3.  **Настройка ПО**:
    *   Перейдите в папку `python_scripts` и установите зависимости:
        ```bash
        pip install -r requirements.txt
        ```

4.  **Запуск системы**: Откройте три терминала и выполните в них следующие команды с указанием нужных портов:
    ```bash
    # Терминал 1: Монитор
    python monitor.py

    # Терминал 2: Исполнитель
    python actuator_subscriber.py "COM7"

    # Терминал 3: Датчик
    python sensor_publisher.py "COM4"
    ```
После запуска третьего скрипта система начнет работать. Закройте фоторезистор рукой, и светодиод на втором микроконтроллере загорится.